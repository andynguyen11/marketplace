packages:
  yum:
    postgresql93-devel: []
    libffi-devel: []
    libcurl-devel: []
    patch: []
    libxslt-devel: []
    libxml2-devel: []

commands:
  01_node_install:
    command: 'sudo yum install -y nodejs npm --enablerepo=epel'
  02_pycurl_nss:
    command: "source /opt/python/run/venv/bin/activate && pip install --compile --no-cache-dir pycurl --global-option='--with-nss'"

container_commands:
  01_migrate:
    command: "source /opt/python/run/venv/bin/activate && python manage.py migrate --noinput"
    leader_only: true
  02_npm_install_gulp:
    command: 'sudo npm set progress=false && sudo npm install && sudo npm install -g gulp-cli'
  03_update_node:
    command: 'sudo npm install -g n && sudo n stable'
  04_update_npm:
    command: 'sudo npm update -g npm'
  05_run_front_end_build:
    command: "gulp dist"
  06_collectstatic:
    command: "source /opt/python/run/venv/bin/activate && python manage.py collectstatic --noinput"

option_settings:
  - namespace: aws:elasticbeanstalk:command
    option_name: Timeout
    value: 1200
  - namespace: aws:elasticbeanstalk:container:python
    option_name: WSGIPath
    value: market/wsgi.py
  - namespace: aws:elasticbeanstalk:container:python:staticfiles
    option_name: /static/
    value: static/
  - option_name: DJANGO_SETTINGS_MODULE
    value: market.settings
  - option_name: AWS_STORAGE_BUCKET_NAME
    value: devquity
