webpackJsonp([7],{"./app/scripts/containers/project/submitProposal.jsx":function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e};r("./app/scripts/containers/project/project.scss");var i=r("./node_modules/react-router/es6/index.js"),n=r("./app/scripts/utils/analytics.js"),l=r("./node_modules/react-redux/lib/index.js"),c=r("./app/scripts/store/actions.js"),p=s(c),u=r("./app/scripts/store/store.js"),m=o(u),f=r("./app/scripts/store/api.js"),d=r("./app/scripts/utils/formUtils.js"),h=r("./app/scripts/utils/piiUtils.js"),v=r("./app/scripts/config.js"),y=r("./app/scripts/components/loader/loader.jsx"),P=o(y),b=r("./app/scripts/components/tile/tile.jsx"),E=r("./app/scripts/components/button/button.jsx"),g=o(E),R=r("./app/scripts/components/forms/formFields.js"),j=r("./app/scripts/components/errors/apiError.jsx"),F=o(j),q={formFields:{},isLoadingProfile:!0,isLoadingProject:!0,profileIncomplete:!1,isSending:!1,apiError:!1,profileError:!1,wantsCash:!1,wantsEquity:!1},S=React.createClass({displayName:"ProfileIncomplete",propTypes:{profile:React.PropTypes.object.isRequired},goToProfile:function(){var e=this.props.profile.id,t=v.urls.profileUrl(e);i.browserHistory.push({pathname:""+t})},render:function(){var e=this.props.profile,t=e.first_name,r=e.last_name,o=e.biography,s=e.role,a=e.photo_url,i=e.city,n=e.country,l=e.capacity,c=e.my_skills,p=e.work_history,u=e.contact_details,m=u.email,f=u.email_confirmed,d=u.phone,h=(!t||!r)&&React.createElement("li",{className:"submitProposal-list-item"},"Your name"),v=!a&&React.createElement("li",{className:"submitProposal-list-item"},"Profile photo"),y=!s&&React.createElement("li",{className:"submitProposal-list-item"},"Developer role"),P=!o&&React.createElement("li",{className:"submitProposal-list-item"},"Short bio"),E=(!i||!n)&&React.createElement("li",{className:"submitProposal-list-item"},"Location"),R=!l&&React.createElement("li",{className:"submitProposal-list-item"},"Availability"),j=!c.length>0&&React.createElement("li",{className:"submitProposal-list-item"},"Skills"),F=(!m||!f)&&React.createElement("li",{className:"submitProposal-list-item"},"Verified contact email"),q=!d&&React.createElement("li",{className:"submitProposal-list-item"},"Phone number"),S=!p.length>0&&React.createElement("li",{className:"submitProposal-list-item"},"Work history");return React.createElement("div",{className:"submitProposal"},React.createElement(b.Tile,{header:"Update your profile"},React.createElement("h3",null,"The following sections of your profile are required to submit a proposal:"),React.createElement("ul",{className:"submitProposal-list"},h,v,y,P,E,R,j,F,q,S),React.createElement(g["default"],{onClick:this.goToProfile},"Go to profile")))}}),C=React.createClass({displayName:"SubmitProposal",propTypes:{user:React.PropTypes.any.isRequired,profile:React.PropTypes.object,project:React.PropTypes.object,params:React.PropTypes.object},getInitialState:function(){return q},formFields:function I(){var e=this,t=this.props.project,I={compensationType:{name:"compensationType",label:"What type of compensation are you seeking?",value:"",options:[{id:"cash",label:"Cash"},{id:"equity",label:"Equity"},{id:"mix",label:"Cash / Equity Mix"}],error:!1,validator:function(t){var r=e.state.formFields,o=d.FormUtils.checks.isRequired(t);return o||(r.compensationType.error="Please choose a compensation type."),e.setState({formFields:r}),o},onChange:function(t){var r=e.state.formFields,o="cash"===t||"mix"===t,s="equity"===t||"mix"===t;r.compensationType.value=t,r.compensationType.error=!1,e.setState({formFields:r,wantsCash:o,wantsEquity:s})}},cash:{name:"cashInput",label:"Cash Offer",value:"",error:!1,validator:function(t){var r=e.state,o=r.wantsCash,s=r.formFields,a=(0,h.doesStringContainPII)(t),i=d.FormUtils.checks.isRequiredInt(t),n=!o||i&&!a;if(!n){var l=s.cash.error="Please enter a cash offer.";a&&(s.cash.error=h.piiErrors.formField),i||(s.cash.error="Your cash offer must be a valid whole number (no commas or decimals)"),t.length||(s.cash.error=l)}return e.setState({formFields:s}),n},onChange:function(t){var r=e.state.formFields;r.cash.value=t,r.cash.error=!1,e.setState({formFields:r})}},equity:{name:"equityInput",label:"Equity Offer",value:"",error:!1,validator:function(t){var r=e.state,o=r.wantsEquity,s=r.formFields,a=(0,h.doesStringContainPII)(t),i=d.FormUtils.checks.isRequired(t),n=parseFloat(t),l=n>0&&n<100,c=!o||i&&l&&!a;if(!c){var p=s.equity.error="Please enter an equity offer.";a&&(s.equity.error=h.piiErrors.formField),l||(s.equity.error="Equity offer must be a number more than 0% and less than 100%."),t.length||(s.equity.error=p)}return e.setState({formFields:s}),c},onChange:function(t){var r=e.state.formFields;r.equity.value=t,r.equity.error=!1,e.setState({formFields:r})}},hours:{name:"hours",label:"How many work hours do you need to complete this job?",value:"",error:!1,validator:function(t){var r=e.state.formFields,o=(0,h.doesStringContainPII)(t),s=d.FormUtils.checks.isRequiredInt(t),a=s&&t>=0&&!o;if(!a){var i=r.hours.error="Please enter a time estimate.";o&&(r.hours.error=h.piiErrors.formField),s||(r.hours.error="Your time estimate must be a valid number."),t.length||(r.hours.error=i)}return e.setState({formFields:r}),a},onChange:function(t){var r=e.state.formFields;r.hours.value=t,r.hours.error=!1,e.setState({formFields:r})}},coverletter:{name:"coverletter",label:"Cover Letter",value:"",helperText:"Explain why you're interested in the job and why your relevant skills make you the right person for the job.",error:!1,rows:5,validator:function(t){var r=e.state.formFields,o=(0,h.doesStringContainPII)(t),s=d.FormUtils.checks.isRequired(t)&&!o;return s||(o?r.coverletter.error=h.piiErrors.formField:r.coverletter.error="Please enter a cover letter."),e.setState({formFields:r}),s},onChange:function(t){var r=e.state.formFields;r.coverletter.value=t,r.coverletter.error=!1,e.setState({formFields:r})}}};return t&&t.questions.length&&t.questions.forEach(function(t,r){var o="question"+t.id;I[o]={name:o,label:"Answer",value:"",error:!1,rows:5,validator:function(t){var r=e.state.formFields,s=(0,h.doesStringContainPII)(t),a=d.FormUtils.checks.isRequired(t)&&!s;return a||(s?r[o].error=h.piiErrors.formField:r[o].error="Please answer this question."),e.setState({formFields:r}),a},onChange:function(t){var r=e.state.formFields;r[o].value=t,r[o].error=!1,e.setState({formFields:r})}}}),I},componentWillMount:function(){this.fetchProfile(),this.fetchProject()},componentWillUnmount:function(){m["default"].dispatch(p.projectLeave()),m["default"].dispatch(p.profileLeave())},fetchProject:function(){var e=this,t=this.props.params.projectIdOrSlug;m["default"].dispatch(p.fetchProject(t,function(){e.setState({isLoadingProject:!1,apiError:!1,formFields:e.formFields()})},function(t,r){console.error(t),e.setState({isLoadingProject:!1,apiError:r&&r.text||t})}))},fetchProfile:function(){var e=this,t=this.props.user.user_id;m["default"].dispatch(p.fetchProfile(t,function(t){e.checkProfileCompletion(t),e.setState({apiError:!1})},function(t,r){console.error(t),e.setState({isLoadingProfile:!1,apiError:r&&r.text||t})}))},checkProfileCompletion:function(e){var t=e.first_name,r=e.last_name,o=e.biography,s=e.role,a=e.photo_url,i=e.city,n=e.country,l=e.capacity,c=e.my_skills,p=e.work_history,u=e.contact_details,m=u.email,f=u.email_confirmed,d=u.phone,h=!0;t&&r&&o&&s&&m&&f&&d&&a&&i&&n&&l&&c.length>0&&p.length>0&&(h=!1),this.setState({isLoadingProfile:!1,profileIncomplete:h,profile:e})},cancelProposalProcess:function(){var e=this.state.project;(0,n.trackEvent)("Cancel Proposal Process",{project:e}),this.goToProject()},goToProposals:function(){i.browserHistory.push({pathname:"/dashboard/proposals/"})},goToProfile:function(){var e=this.props.profile.id,t=v.urls.profileUrl(e);i.browserHistory.push({pathname:""+t})},goToProject:function(){var e=this.props.project.slug,t=v.urls.projectUrl(e);i.browserHistory.push({pathname:""+t})},createProposal:function(){var e=this,t=this.state.formFields,r=this.props,o=r.project;r.user.user_id;this.setState({apiError:!1},function(){d.FormUtils.validateForm(t,function(t,r){e.setState({formFields:r}),t&&!function(){e.setState({isLoading:!0});var t={cash:r.cash.value||null,equity:r.equity.value||null,hours:r.hours.value,cover_letter:r.coverletter.value,project:o.id};o.questions.length&&(t.answers=o.questions.map(function(e){var t="question"+e.id;return{question:e.id,text:r[t].value}})),e.setState({isSending:!0,apiError:!1},function(){var r=f.api.proposal;return(0,f.post)(r,t,function(){(0,n.trackEvent)("Proposal Submitted ",{message:t.message}),e.goToProposals()},function(t,r){console.error(t),e.setState({apiError:r.text,isSending:!1})})})}()})})},render:function(){var e=this.props.project,t=this.state,r=t.formFields,o=t.wantsCash,s=t.wantsEquity,a=t.isSending,i=t.apiError,n=t.isLoadingProfile,l=t.isLoadingProject,c=t.profileIncomplete,p=t.profile,u=t.profileError;if(n||l)return React.createElement(P["default"],null);if(c)return React.createElement(S,{profile:p});if(u)return React.createElement(F["default"],{error:m});var m=i&&React.createElement(F["default"],{error:i}),f=o&&React.createElement(R.Input,{config:r.cash,className:"submitProposal-compensationInput",prefix:"$",suffix:".00",inputDisabled:a}),d=s&&React.createElement(R.Input,{config:r.equity,className:"submitProposal-compensationInput",suffix:"%",inputDisabled:a}),h=!!e.questions.length&&e.questions.map(function(e,t){var o="question"+e.id;return React.createElement("span",{key:t},React.createElement("h3",null,e.text),React.createElement(R.Textarea,{config:r[o],inputDisabled:a}))});return React.createElement("div",{className:"submitProposal"},React.createElement("h2",null,"Submit a proposal for ",React.createElement("a",{href:"",className:"brand"},e.title)),React.createElement("h3",null,"Proposed compensation for services"),React.createElement("div",{className:"submitProposal-compensation"},React.createElement(R.RadioGroup,{config:r.compensationType,className:"submitProposal-compensationType",inputDisabled:a}),React.createElement("div",{className:"submitProposal-compensationInputs"},f,d)),React.createElement(R.Input,{config:r.hours,className:"submitProposal-hoursInput",suffix:"hours",inputDisabled:a}),React.createElement("h3",null,"Introduce yourself"),React.createElement(R.Textarea,{config:r.coverletter,inputDisabled:a}),h,React.createElement("p",{className:"small"},"By clicking send you agree to Loom's ",React.createElement("a",{href:"/terms-of-service/",target:"_blank"},"Terms and Conditions")),m,React.createElement("div",{className:"submitProposal-actions"},React.createElement(g["default"],{onClick:this.cancelProposalProcess,buttonType:"secondary",disabled:a},"Cancel"),React.createElement(g["default"],{onClick:this.createProposal,disabled:a,isLoading:a},"Send proposal")))}}),w=function(e){var t=e.auth,r=e.project,o=e.profile;return a({user:t},r,o)};t["default"]=(0,l.connect)(w)(C)}});